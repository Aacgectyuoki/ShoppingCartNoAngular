<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Items To Cart</title>

  <link href='https://fonts.googleapis.com/css?family=Pangolin' rel='stylesheet'>
  
<!-- JS Code for switching pages -->
<script>
  function show(shown, hidden) {
    document.getElementById(shown).style.display='block';
    document.getElementById(hidden).style.display='none';
    return false;
  }
  </script>

<!-- CSS inside, because my VS Code started acting up -->
  <style>
body {
    font-family: 'Pangolin';
    font-weight: 100;
    display: flex;
    justify-content: center;
    background-color: #54afda;
}

input {
    font-family: 'Pangolin';
    padding: 0.5em;
    margin: 0.5em;
    font-size: 1em;
    border: 1px solid;
}

button {
    font-family: 'Pangolin';
    padding: 0.5em;
    font-size: 1em;
    margin: 0.5em;
    min-width: 3em;
    border: 1px solid;
    border-radius: 12px;
    background-color: #eee;
}

#items {
    list-style: none;
    margin: 0;
    padding: 0;
}

#items > li {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
  </style>
</head>

<body>
  <div class="page" id="cart1">
    <h1>Please enter the name of the item and the price of the item that you are buying</h1>
    <form id="add-form" style="font-size: 16px;">
      <label style="font-size: 16px;">
        Item Name:
        <input id="name" type="text" placeholder="Item Name">
      </label>
      <label style="font-size: 16px;">
      </br>
        Item Price:
        <input id="price" type="number" step="0.01" placeholder="Item Price">
      </label>
      <button id="add" type="submit">Add Item</button>
    </form>

    <ul id="items">
      <!-- Items here -->
    </ul>
    <button><a href="#cart2" onclick="return show('cart2','cart1');">Checkout</a></button>
  </div>

  <div class="page" id="cart2" style="display:none;">
    <!-- Page2 -->
    <h1>Total Price (Dollars)
      <div id="total" style="text-align:center;">
        <h1>0.00</h1>
      </div></h1>
      <button><a href="#cart1" onclick="return show('cart1','cart2');">Go Back</a></button>
  <!-- <a href="cart2.html" target="_blank">Click here for the total price</a> -->
  </div>

<!-- JS Code inside, because my VS Code started acting up -->
  <script>
    document.querySelector('body').onclick = (e) => {
    console.log('---------------------------------')
    console.log(e.target)
    }

    const addForm = document.getElementById('add-form')
    const inputName = document.getElementById('name')
    const inputPrice = document.getElementById('price')
    const itemsList = document.getElementById('items')
    const divTotal = document.getElementById('total')

    const cart = []

    addForm.onsubmit = function(e) {
    e.preventDefault()
    const name = inputName.value
    const price = inputPrice.value

    addToCart(name, price)
    showCart()
    }

    itemsList.onclick = function(e) {
    console.log(e.target)
    if (e.target && e.target.classList.contains('remove')) {
        console.log(e.target.dataset.name)
        removeFromCart(e.target.dataset.name)
    }
    }

    itemsList.onchange = function(e) {
    if (e.target && e.target.classList.contains('update')) {
        const qty = parseInt(e.target.value)
        const name = e.target.dataset.name
        updateCart(name, qty)

    }
    }

    function addToCart(name, price) {
    for (let i = 0; i < cart.length; i += 1) {
        if (cart[i].name === name) {
        cart[i].qty += 1
        showCart()
        return true
        }
    }
    cart.push({ name, price, qty: 1})
    showCart()
    }

    function removeFromCart(name, qty = 0) {
    console.log(name, qty)
    for (let i = 0; i < cart.length; i += 1) {
        if (cart[i].name === name) {
        if (qty) {
            let newQty = cart[i].qty - qty
            if (newQty > 0) {
            cart[i].qty = newQty
            } else {
            cart.splice(i, 1)
            }
        } else {
            cart.splice(i, 1)
        }
              }
            }

            showCart()
          }

      function showCart() {
        let str = ''
        for (let i = 0; i < cart.length; i += 1) {
          str += `<li>
            <span>
              ${cart[i].name} -> $${cart[i].price} each
              * ${cart[i].qty} = $${(cart[i].qty * cart[i].price).toFixed(2)}
            </span>
            <span>
              <button class="remove" data-name="${cart[i].name}">remove</button>
            </span>
          </li>`
        }
        itemsList.innerHTML = str
        divTotal.innerHTML = getTotal()
      }

      function getTotal() {
        let total = 0
        for (let i = 0; i < cart.length; i += 1) {
          total += cart[i].price * cart[i].qty
        }
        return total.toFixed(2)
      }

      function updateCart(name, qty) {
        for (let i = 0; i < cart.length; i += 1) {
          if (cart[i].name === name) {
            cart[i].qty = qty
            showCart()
            return true
          }
        }
        return false
      }

      showCart()

      getTotal()

  </script>

</body>
</html>
